<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Wordiness — Focus Finder</title>
<style>
  :root{--text:#eef2ff;--muted:rgba(238,242,255,.72);--line:rgba(238,242,255,.16);
  --ok:#22c55e;--no:#ef4444;--acc:#38bdf8;--r:16px;--base:18px;--lh:1.75;--ls:0px;--ws:0px;}
  body.supported{--base:19px;--lh:1.9;--ls:.2px;--ws:.6px;}
  body{margin:0;color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
    font-size:var(--base);line-height:var(--lh);letter-spacing:var(--ls);word-spacing:var(--ws);
    background:
      radial-gradient(900px 500px at 15% -10%, rgba(56,189,248,.14), transparent 60%),
      radial-gradient(900px 500px at 92% 10%, rgba(34,197,94,.12), transparent 55%),
      linear-gradient(180deg,#050816,#070b16 55%,#050816);}
  .wrap{max-width:1100px;margin:0 auto;padding:16px}
  header{position:sticky;top:10px;z-index:10;backdrop-filter:blur(10px);
    border:1px solid var(--line);border-radius:var(--r);
    background:linear-gradient(180deg, rgba(16,27,51,.85), rgba(11,20,40,.75));
    padding:12px 14px;display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:space-between;}
  h1{margin:0;font-size:18px}.sub{margin-top:2px;color:var(--muted);font-size:13px}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  select,button{font:inherit}
  select{background:rgba(0,0,0,.25);color:var(--text);border:1px solid var(--line);padding:8px 10px;border-radius:12px;outline:none}
  button{cursor:pointer;border-radius:12px;padding:10px 12px;color:var(--text);
    border:1px solid rgba(34,197,94,.35);background:linear-gradient(180deg, rgba(34,197,94,.18), rgba(34,197,94,.08));}
  button.ghost{border:1px solid var(--line);background:rgba(255,255,255,.04)}
  .card{margin-top:14px;border:1px solid var(--line);border-radius:var(--r);
    background:linear-gradient(180deg, rgba(16,27,51,.75), rgba(11,20,40,.7));overflow:hidden}
  .hd{padding:12px 14px;border-bottom:1px solid var(--line);display:flex;gap:10px;flex-wrap:wrap;justify-content:space-between}
  .bd{padding:14px}
  .big{font-size:22px;font-weight:900;margin:0}
  .hint{margin:8px 0 0;color:var(--muted);font-size:13px}
  .textbox{padding:14px;border:1px dashed rgba(238,242,255,.22);border-radius:14px;background:rgba(0,0,0,.12);text-align:left}
  .word{display:inline-block;margin:2px 4px;padding:6px 10px;border-radius:999px;border:1px solid rgba(238,242,255,.14);
    background:rgba(255,255,255,.03);cursor:pointer;user-select:none;font-weight:800}
  .word.on{border-color:rgba(56,189,248,.55);background:rgba(56,189,248,.10)}
  .word.correct{border-color:rgba(34,197,94,.55);background:rgba(34,197,94,.10)}
  .word.wrong{border-color:rgba(239,68,68,.55);background:rgba(239,68,68,.10)}
  .mini{display:none;margin-left:8px;font-size:12px;padding:2px 7px;border-radius:999px;border:1px solid rgba(238,242,255,.16);
    background:rgba(0,0,0,.18);color:rgba(238,242,255,.82)}
  body.supported .word.on .mini{display:inline-block}
  .status{margin-top:12px;padding:10px 12px;border:1px solid var(--line);border-radius:14px;background:rgba(255,255,255,.03);
    font-size:13px;color:rgba(238,242,255,.86);display:flex;gap:10px;flex-wrap:wrap;justify-content:space-between;}
  .ok{color:var(--ok);font-weight:900}.no{color:var(--no);font-weight:900}
</style>
<style>
/* wordiness-ui-polish-v4 */
:root{
  --tapMin: 44px;
  --safeBottom: env(safe-area-inset-bottom, 0px);
}
html, body{ height: 100%; }
body{
  min-height: 100dvh;
  padding-bottom: var(--safeBottom);
  -webkit-text-size-adjust: 100%;
  overscroll-behavior: contain;
}
@supports (height: 100svh){ body{ min-height: 100svh; } }

*{ -webkit-tap-highlight-color: transparent; }

button, [role="button"], a, input, select, textarea,
.tile, .wordCard, .slot, .badge{
  min-height: var(--tapMin);
}

button, [role="button"], a, .tile, .wordCard, .slot{
  touch-action: manipulation;
  user-select: none;
  -webkit-user-select: none;
}

input, textarea, select{
  font-size: 16px !important; /* prevent iOS zoom */
}

[draggable="true"], .wordiness-draggable{
  touch-action: none; /* reduce scroll-vs-drag fighting */
}

.wordiness-drag-selected{
  outline: 3px solid rgba(56,189,248,.55) !important;
}

@media (prefers-reduced-motion: reduce){
  *{ scroll-behavior: auto !important; transition: none !important; animation: none !important; }
}
</style>
</head>
<body>
<div class="wrap">
<header>
  <div>
    <h1>Focus Finder</h1>
    <div class="sub">Click words that match the pattern. Supported shows “match / not” AFTER you click (same answers).</div>
  </div>
  <div class="row">
    <label class="row" style="gap:6px;color:var(--muted);font-size:13px">View
      <select id="variant"><option value="standard">Standard</option><option value="supported">Supported</option></select>
    </label>
    <label class="row" style="gap:6px;color:var(--muted);font-size:13px">Voice <select id="voice"></select></label>
    <select id="taskSel"></select>
    <button class="ghost" id="read">Read text</button>
    <button class="ghost" id="clear">Clear</button>
    <button id="check">Check</button>
  </div>
</header>

<section class="card">
  <div class="hd">
    <div>
      <div class="sub">Task</div>
      <p class="big" id="taskTitle">—</p>
      <p class="hint" id="taskHint"></p>
    </div>
    <div class="row">
      <button class="ghost" id="show">Show answers</button>
    </div>
  </div>
  <div class="bd">
    <div class="textbox" id="text"></div>
    <div class="status">
      <span>Status: <b id="status">ready</b></span>
      <span>Selected: <b id="sel">0</b> • Correct: <b id="corr">0</b>/<b id="need">0</b></span>
    </div>
  </div>
</section>
</div>

<script>
const TEXT =
"We had a discussion about responsibility in our community. Sometimes people disagree, but respectful conversation helps everyone. " +
"If a decision is difficult, we can break the task into smaller steps. We can replay ideas, review notes, and organise our work.";

const TASKS=[
  {id:"tion", title:"Find words ending in -tion", hint:"Look for t-i-o-n at the end.", match:(w)=>w.toLowerCase().endsWith("tion")},
  {id:"re",   title:"Find words starting with re-",   hint:"re- often means again.", match:(w)=>w.toLowerCase().startsWith("re")},
  {id:"dbl",  title:"Find words with double letters", hint:"Two of the same letter together (like ss).", match:(w)=>/([a-z])\1/i.test(w)},
];

const $=(s,r=document)=>r.querySelector(s);

/* TTS */
let voices=[];
function refreshVoices(){
  if(!window.speechSynthesis) return;
  voices=speechSynthesis.getVoices()||[];
  const sel=$("#voice"); sel.innerHTML="";
  const o0=document.createElement("option"); o0.value=""; o0.textContent=voices.length?"Default":"No voices"; sel.appendChild(o0);
  voices.forEach((v,i)=>{const o=document.createElement("option");o.value=String(i);o.textContent=`${v.name} (${v.lang})`;sel.appendChild(o);});
}
function speak(text,rate=1.0){
  if(!window.speechSynthesis) return;
  const u=new SpeechSynthesisUtterance(String(text||""));
  const idx=parseInt($("#voice").value,10);
  if(Number.isFinite(idx)&&voices[idx]) u.voice=voices[idx];
  u.rate=Math.max(0.65,Math.min(1.15,rate));
  speechSynthesis.cancel(); speechSynthesis.speak(u);
}

const state={variant:"standard", taskId:TASKS[0].id, words:[], selected:new Set()};

function tokenize(t){
  return t.split(/\s+/).filter(Boolean).map((raw,i)=>{
    const clean=raw.replace(/^[^\w]+|[^\w]+$/g,"");
    return {i, raw, clean};
  });
}
function task(){ return TASKS.find(x=>x.id===state.taskId)||TASKS[0]; }
function answers(){
  const a=new Set();
  state.words.forEach(w=>{ if(task().match(w.clean)) a.add(w.i); });
  return a;
}
function setVariant(v){
  state.variant=(v==="supported")?"supported":"standard";
  document.body.classList.toggle("supported", state.variant==="supported");
  render();
}
function setStatus(t){ $("#status").innerHTML=t; }

function renderHeader(){
  $("#taskTitle").textContent=task().title;
  $("#taskHint").textContent=(state.variant==="supported")
    ? `Support: ${task().hint} (Click a word to see “match / not”.)`
    : task().hint;
  $("#need").textContent=String(answers().size);
}
function renderText(){
  const box=$("#text"); box.innerHTML="";
  state.words.forEach(w=>{
    const s=document.createElement("span");
    s.className="word";
    const isOn=state.selected.has(w.i);
    s.classList.toggle("on", isOn);

    const why=task().match(w.clean) ? "match" : "not";
    s.innerHTML = `${w.raw}<span class="mini">${why}</span>`;

    s.addEventListener("click",()=>toggle(w.i));
    box.appendChild(s);
  });
}
function toggle(i){
  if(state.selected.has(i)) state.selected.delete(i); else state.selected.add(i);
  $("#sel").textContent=String(state.selected.size);
  if(state.variant==="supported"){
    const w=state.words.find(x=>x.i===i);
    if(w) speak(w.clean||w.raw,0.95);
  }
  setStatus("ready");
  renderText();
}
function clearSel(){
  state.selected=new Set();
  $("#sel").textContent="0"; $("#corr").textContent="0";
  setStatus("ready");
  render();
}
function check(){
  const a=answers();
  const nodes=[...$("#text").querySelectorAll(".word")];
  nodes.forEach((node,i)=>{
    node.classList.remove("correct","wrong");
    if(state.selected.has(i)) node.classList.add(a.has(i) ? "correct" : "wrong");
  });
  let corr=0; state.selected.forEach(i=>{ if(a.has(i)) corr++; });
  $("#corr").textContent=String(corr);
  if(corr===a.size && state.selected.size===a.size) setStatus(`<span class="ok">all correct ✅</span>`);
  else setStatus(`<span class="no">keep going</span> — ${corr}/${a.size} correct`);
}
function show(){
  state.selected=new Set([...answers()]);
  $("#sel").textContent=String(state.selected.size);
  check(); setStatus("answers shown");
}

function render(){
  renderHeader();
  renderText();
}
function init(){
  const sel=$("#taskSel");
  TASKS.forEach(t=>{const o=document.createElement("option");o.value=t.id;o.textContent=t.title;sel.appendChild(o);});
  state.words=tokenize(TEXT);

  $("#variant").addEventListener("change",(e)=>setVariant(e.target.value));
  $("#taskSel").addEventListener("change",(e)=>{state.taskId=e.target.value; clearSel();});
  $("#read").addEventListener("click",()=>speak(TEXT,0.95));
  $("#clear").addEventListener("click",clearSel);
  $("#check").addEventListener("click",check);
  $("#show").addEventListener("click",show);

  refreshVoices(); if(window.speechSynthesis) speechSynthesis.onvoiceschanged=refreshVoices;
  render();
}
init();
</script>
<!-- WORDINESS_FAILSAFE_PATCH v1 -->
<script id="wordiness-failsafe-patch">
(function(){
  if (window.__wordinessFailsafePatch) return;
  window.__wordinessFailsafePatch = true;

  const VOWEL = /[aeiouy]/i;

  const EXCEPTIONS = {
    different:   { spelling:["dif","fer","ent"], spoken:[["dif","frent"],["dif","rent"]] },
    vegetable:   { spelling:["ve","ge","ta","ble"], spoken:[["veg","ta","ble"],["vej","ta","bul"]] },
    factory:     { spelling:["fac","to","ry"], spoken:[["fac","tuh","ree"],["fac","tri"]] },
    family:      { spelling:["fam","i","ly"], spoken:[["fam","ly"]] },
    chocolate:   { spelling:["choc","o","late"], spoken:[["choc","late"]] },
    camera:      { spelling:["cam","er","a"], spoken:[["cam","ra"]] },
    interesting: { spelling:["in","ter","est","ing"], spoken:[["in","tres","ting"]] },
    probably:    { spelling:["prob","a","bly"], spoken:[["prob","ly"]] }
  };

  function hasVowelLetters(s){ return VOWEL.test(String(s||"")); }
  function lettersSpaced(s){ return String(s||"").split("").join(" "); }
  function onlyLetters(s){ return String(s||"").toLowerCase().replace(/[^a-z']/g,""); }

  function normalizeLine(s){
    return String(s||"")
      .replace(/[\u2010\u2011\u2012\u2013\u2014\u2212]/g, "-") // fancy dashes
      .replace(/\u00B7/g, "·") // middle dot
      .trim();
  }

  // Extract sensible words from pasted text, but preserve already-marked syllable lines
  function sanitizeSeedText(raw){
    raw = String(raw||"").replace(/\r/g,"");
    const out = [];
    for (const line0 of raw.split("\n")) {
      const line = normalizeLine(line0);
      if (!line) continue;

      // Keep marked syllable lines like dif-fer-ent (no spaces)
      if (/[-·]/.test(line) && !/\s/.test(line)) {
        out.push(line);
        continue;
      }

      // Otherwise extract word tokens from the line
      const toks = line.match(/[A-Za-z]+(?:'[A-Za-z]+)?/g);
      if (!toks) continue;
      for (const w of toks) {
        if (w.length > 28) continue;
        if (!hasVowelLetters(w)) continue;
        out.push(w);
      }
    }

    // de-dupe, preserve order
    const seen = new Set();
    const final = [];
    for (const w of out) {
      const k = w.toLowerCase();
      if (seen.has(k)) continue;
      seen.add(k);
      final.push(w);
    }
    return final.join("\n");
  }

  // Replace a specific line (by index) with chunked form, joined by '-'
  function replaceLine(text, lineIndex, newChunks){
    const lines = String(text||"").replace(/\r/g,"").split("\n");
    if (lineIndex < 0 || lineIndex >= lines.length) return text;
    lines[lineIndex] = newChunks.join("-");
    return lines.join("\n");
  }

  // Find a textarea likely used for word lists
  function findSeedTextarea(){
    return document.querySelector("textarea#input, textarea#seed, textarea[data-seed], textarea");
  }

  // Build helper UI under textarea: reduction suggestions + failsafe warnings + sanitize button
  function attachHelperUI(ta){
    if (!ta || ta.__wordinessHelperAttached) return;
    ta.__wordinessHelperAttached = true;

    const host = document.createElement("div");
    host.style.cssText = [
      "margin-top:10px",
      "border:1px solid rgba(255,255,255,.14)",
      "border-radius:14px",
      "padding:10px 12px",
      "background:rgba(0,0,0,.10)",
      "color:rgba(238,242,255,.85)",
      "font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial",
      "font-size:13px"
    ].join(";");

    const hdr = document.createElement("div");
    hdr.style.cssText = "display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap;";
    hdr.innerHTML = `<b>Wordiness helpers</b>
      <span style="opacity:.8">failsafes + disappearing-vowel options</span>`;
    host.appendChild(hdr);

    const btnRow = document.createElement("div");
    btnRow.style.cssText = "display:flex;gap:8px;flex-wrap:wrap;margin-top:10px;";
    const sanitizeBtn = document.createElement("button");
    sanitizeBtn.type = "button";
    sanitizeBtn.textContent = "Sanitize pasted text → words";
    sanitizeBtn.style.cssText =
      "cursor:pointer;border-radius:999px;padding:8px 10px;border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.04);color:rgba(238,242,255,.92);font-weight:700;";
    btnRow.appendChild(sanitizeBtn);
    host.appendChild(btnRow);

    const msg = document.createElement("div");
    msg.style.cssText = "margin-top:10px;opacity:.9;";
    host.appendChild(msg);

    const sug = document.createElement("div");
    sug.style.cssText = "display:flex;gap:8px;flex-wrap:wrap;margin-top:10px;";
    host.appendChild(sug);

    function refresh(){
      const raw = String(ta.value||"");
      const lines = raw.replace(/\r/g,"").split("\n").map(normalizeLine);
      sug.innerHTML = "";

      // Warnings: chunks with no vowel letters (only checks marked chunk lines)
      let warnCount = 0;
      for (const ln of lines) {
        if (!ln) continue;
        if (/[-·]/.test(ln) && !/\s/.test(ln)) {
          const parts = ln.split(/[-·]+/).map(s=>s.trim()).filter(Boolean);
          const bad = parts.filter(p=>!hasVowelLetters(p));
          if (bad.length) warnCount++;
        }
      }

      // Suggestions for disappearing vowels
      const found = [];
      lines.forEach((ln, i)=>{
        if (!ln) return;
        const key = onlyLetters(ln.replace(/[-·]/g,""));
        if (EXCEPTIONS[key]) found.push({ key, i });
      });

      msg.innerHTML =
        `${warnCount ? `<span style="color:#f59e0b;font-weight:800">${warnCount} warning(s)</span> (chunk has no vowel letters). ` : `<span style="color:#22c55e;font-weight:800">No failsafe warnings</span>. `}
         ${found.length ? `Found <b>${found.length}</b> reduction word(s).` : `No reduction words detected in list.`}`;

      // Make buttons for each found word
      found.slice(0, 12).forEach(({key, i})=>{
        const ex = EXCEPTIONS[key];
        const label = key;
        const makeBtn = (text, chunks) => {
          const b = document.createElement("button");
          b.type = "button";
          b.textContent = `${label}: ${text}`;
          b.style.cssText =
            "cursor:pointer;border-radius:999px;padding:8px 10px;border:1px solid rgba(56,189,248,.28);background:rgba(56,189,248,.08);color:rgba(238,242,255,.92);font-weight:800;";
          b.onclick = ()=>{
            ta.value = replaceLine(ta.value, i, chunks);
            ta.dispatchEvent(new Event("input", { bubbles:true }));
          };
          return b;
        };

        if (ex.spelling) sug.appendChild(makeBtn("Use spelling", ex.spelling));
        if (Array.isArray(ex.spoken)) {
          ex.spoken.forEach(opt => sug.appendChild(makeBtn("Use spoken", opt)));
        }
      });
    }

    sanitizeBtn.onclick = ()=>{
      const before = ta.value;
      const after = sanitizeSeedText(before);
      if (after && after !== before) {
        ta.value = after;
        ta.dispatchEvent(new Event("input", { bubbles:true }));
      }
    };

    // Insert right after textarea
    ta.insertAdjacentElement("afterend", host);

    // Live update
    let t = null;
    ta.addEventListener("input", ()=>{
      clearTimeout(t);
      t = setTimeout(refresh, 120);
    });
    refresh();
  }

  // TTS fail-safe wrapper: if no vowel letters and short, speak letters spaced
  function wrapSpeak(fnName){
    const old = window[fnName];
    if (typeof old !== "function") return;
    if (old.__wordinessWrapped) return;

    function wrapped(text, ...rest){
      const t = String(text||"").trim();
      if (t && !hasVowelLetters(t) && t.length <= 8) {
        return old.call(this, lettersSpaced(t), ...rest);
      }
      return old.call(this, text, ...rest);
    }
    wrapped.__wordinessWrapped = true;
    window[fnName] = wrapped;
  }

  // Try common TTS function names used across your games
  ["speakNow","speak","speakText","say"].forEach(wrapSpeak);

  // Seed sanitiser if game uses #seed=
  function patchSeedFromHash(){
    const h = String(location.hash||"");
    if (!/seed=/.test(h)) return;
    const ta = findSeedTextarea();
    if (!ta) return;
    const before = ta.value;
    const after = sanitizeSeedText(before);
    if (after && after !== before) {
      ta.value = after;
      ta.dispatchEvent(new Event("input", { bubbles:true }));
    }
  }

  // Attach helpers on load
  function boot(){
    const ta = findSeedTextarea();
    if (ta) attachHelperUI(ta);
    patchSeedFromHash();
  }

  window.addEventListener("hashchange", ()=>setTimeout(patchSeedFromHash, 0));
  setTimeout(boot, 80);

})();
</script>
<!-- /WORDINESS_FAILSAFE_PATCH v1 -->
<script>
// wordiness-touch-helpers-v4
(function(){
  try{
    var isCoarse=false;
    try{ isCoarse = window.matchMedia && window.matchMedia("(pointer: coarse)").matches; }catch(e){}
    var isTouch = isCoarse || ("ontouchstart" in window) || (navigator.maxTouchPoints && navigator.maxTouchPoints>0);

    // Crest fallback (works for /wordiness and file:// exports)
    var crest = document.getElementById("crest");
    if (crest && crest.tagName === "IMG") {
      crest.addEventListener("error", function(){ crest.src="/wordiness/crest.png"; }, { once:true });
    }

    if(!isTouch) return;

    var drags = Array.prototype.slice.call(document.querySelectorAll('[draggable="true"]'));
    if(!drags.length) return;

    drags.forEach(function(el){
      el.classList.add("wordiness-draggable");
      el.addEventListener("click", function(){
        drags.forEach(function(x){ x.classList.remove("wordiness-drag-selected"); });
        el.classList.add("wordiness-drag-selected");
      }, { passive:true });
    });

    var btn = document.createElement("button");
    btn.id="wordinessTouchToggle";
    btn.type="button";
    btn.style.position="fixed";
    btn.style.right="12px";
    btn.style.bottom="calc(12px + env(safe-area-inset-bottom, 0px))";
    btn.style.zIndex="9999";
    btn.style.border="1px solid rgba(255,255,255,.18)";
    btn.style.background="rgba(0,0,0,.45)";
    btn.style.color="rgba(238,242,255,.95)";
    btn.style.backdropFilter="blur(10px)";
    btn.style.borderRadius="999px";
    btn.style.padding="10px 12px";
    btn.style.font="600 13px system-ui, -apple-system, Segoe UI, Roboto, Arial";
    btn.style.touchAction="manipulation";

    var dragEnabled=true;
    function applyState(){
      drags.forEach(function(el){ el.setAttribute("draggable", dragEnabled ? "true" : "false"); });
      btn.textContent = dragEnabled ? "Touch: Drag ON" : "Touch: Drag OFF";
    }
    btn.addEventListener("click", function(){ dragEnabled=!dragEnabled; applyState(); });

    document.body.appendChild(btn);
    applyState();
  }catch(e){}
})();
</script>
</body>
</html>
